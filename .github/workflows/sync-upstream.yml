name: Sync with Upstream

on:
  schedule:
    - cron: '0 0 * * 0' # Runs every Sunday at midnight UTC
  workflow_dispatch: # Allows manual triggering

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Check out your fork's 'master' branch
      - name: Checkout Fork
        uses: actions/checkout@v4
        with:
          ref: 'master'

      # Step 2: Create a new branch and merge upstream changes into it
      - name: Merge Upstream
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          git checkout -b sync-upstream
          
          git remote add upstream https://github.com/openjdk/jdk.git
          git fetch upstream
          
          # Merge with the new flag to allow unrelated histories
          git merge upstream/master --allow-unrelated-histories
        
      # Step 3: Create the Pull Request
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "Sync with upstream openjdk/jdk"
          body: "This PR syncs the latest changes from the upstream `openjdk/jdk` repository."
          branch: "sync-upstream"
          base: "master"
          assignees: "${{ github.actor }}"
          reviewers: "${{ github.actor }}"
          delete-branch: true

      # --- Notification step is still disabled ---
      # - name: Notify on failure via email
      #   if: ${{ failure() }}
      #   uses: dawidd6/action-send-mail@v3
      #   with:
      #     # ... email settings ...
